---
title: "map_tag()"
resource_files:
- vft.csv
runtime: shiny
output:
  flexdashboard::flex_dashboard:
    theme: united
    orientation: columns
    social: menu
    source_code: embed
    navbar:
      - {title: "Mauro Lepore", href: "https://github.com/maurolepore", align: right, icon: fa-user}
---

```{r global, include=FALSE}
library(flexdashboard)
library(try)
library(dplyr)
library(ggplot2)
library(icon)
```

Upload a file, change key arguments of map_tag(), and preview the effect
=======================================================================

--- DATA {data-width=350}
-----------------------------------------------------------------------

```{r}
vft20 <- readr::read_csv("vft20.csv")
vft40 <- readr::read_csv("vft40.csv")
selectInput("vft", "Choose an example data set", 
  choices = c("Dataset with quadrat side = 20 m", "Dataset with quadrat side = 40 m")
)
vft <- reactive({
  if (input$vft == "Dataset with quadrat side = 20 m") {
    vft20
  } else {
    vft40
  }
})
```

```{r}
renderPrint({
  rngx <- paste0(range(vft()$x), collapse = " ")
  rngy <- paste0(range(vft()$y), collapse = " ")
  cat("range x: ", rngx, "\n", "range y: ", rngy, "\n", "\n", sep = "")
  
  vft()
})
```



--- ARGUMENTS {data-width=250}
-----------------------------------------------------------------------

`r icon::fa_question_circle()` [`map_tag()`](https://forestgeo.github.io/try/reference/map_tag.html)

```{r}
textInput("site", "site_name", "My site, 2017")

fluidRow(
  column(6, numericInput("xquad", "x_q", 20)),
  column(6, numericInput("xsubquad", "x_sq", 5))
)

fluidRow(
  column(6, numericInput("tagsize", "tag_size", 3)),
  column(6, numericInput("pointsize", "point_size", 1.5))
)

fluidRow(
  column(
    6, 
    sliderInput(
      "pointshape_alive", "point_shape (alive)", min = 1, max = 25, 19)
  ),
  column(
    6, 
    sliderInput(
      "pointshape_dead", "point_shape (dead)", min = 1, max = 25, 4)
  )
)
```

`r icon::fa_question_circle()` [`get_header()`](https://forestgeo.github.io/try/reference/get_header.html)

```{r}
textInput("line_1", "line1", pad(c("Checking: ", "Checked date: ")))
textInput("line_2", "line2", pad(c("Recording: "), total_width = 24))
textInput("line_3", "line3", pad(c("Measuring: ", "Measurement date: ")))
```

--- PLOT {data-width=350}
-----------------------------------------------------------------------

### Preview

```{r, fig.asp=1.15}
renderPlot({
  maps <- map_tag(
    vft(), 
    x_q = input$xquad,
    x_sq = input$xsubquad,
    site_name = input$site,
    point_size = input$pointsize,
    point_shape = c(input$pointshape_alive, input$pointshape_dead),
    tag_size = input$tagsize,
    header = get_header(
      line1 = input$line_1,
      line2 = input$line_2,
      line3 = input$line_3
    )
  )
  maps[[1]]
})
```

