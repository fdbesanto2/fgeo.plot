---
title: "Review Plots that Avoid Text Overlap"
author: "maurolepore@gmail.com"
date: "2017-09-22"
output: 
  rmarkdown::html_document:
    toc: true
    toc_depth: 6
---

```{r setup, include=FALSE}
# > There is one chunk name that imbues special behaviour: setup. When you're in
# a notebook mode, the chunk named setup will be run automatically once, before 
# any other code is run.
# --http://r4ds.had.co.nz/r-markdown.html#chunk-options



# Load packages (including data-packages) ----

library(ggplot2)
library(dplyr)



# Load un-packaged dependencies ----





# Figures ----

# > If you want to make sure the font size is consistent across all your 
# figures, whenever you set out.width, you'll also need to adjust fig.width to 
# maintain the same ratio with your default out.width. For example, if your 
# default fig.width is 6 and out.width is 0.7, when you set out.width = "50%" 
# you'll need to set fig.width to 4.3 (6 * 0.5 / 0.7).
# --http://r4ds.had.co.nz/

set.seed(1014)
options(digits = 3)

knitr::opts_chunk$set(
  echo = TRUE,
  comment = "#>",
  collapse = TRUE,
  cache = TRUE,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6,
  fig.asp = 0.618,  # 1 / phi
  fig.show = "hold"
)

options(dplyr.print_min = 6, dplyr.print_max = 6)

# customize ggplot

update_geom_defaults("point", 
  list(shape = 21, colour = "black", size = 5, stroke = 1)
)
update_geom_defaults("text", list(size = 4.5))
```

> I'm curious to see how it looks for subquadrats with more trees, i.e. quadrats 408 or 2208.

--Suzanne

Filter and plot data of two quadrats:

1. to show crowded points.
2. to show padding quadrat names with cero to the left.



```{r}
library(tidyverse)
library(ggrepel)
library(try)
```

```{r}
# Choose the quadrat with highest number of trees (n)
tag_n <- sin_q20 %>%
  map(~summarize(., n())) %>%
  map(pull) %>%
  unlist()
name_of_quad_with_max_n <- names(tag_n[which.max(tag_n)])

# Also choose a quadrat 15 and pad its name with "0" to the left.
name_of_quad_to_pad <- "15"
name_of_selected_quad <- c(name_of_quad_with_max_n, name_of_quad_to_pad)
name_of_selected_quad

# Filter the data and pad quadrat names
selected_quadrats <- sin_q20[name_of_selected_quad]
paded_names <- str_pad(name_of_selected_quad, 4, pad = "0")
names(selected_quadrats) <- paded_names
names(selected_quadrats)
```

Now that the data is ready, let's plot it.

```{r}
this_site <- "Sinharaja 2017"

crowded_quad <- selected_quadrats[1]

pdf(onefile = TRUE, paper = "a4", width = 11, height = 11)
lapply_plot_repel(crowded_quad, site = this_site)
dev.off()
```

From this comments https://goo.gl/BbapGz by Suzanne, I addressed 1-4.

* Item 3 is addressed using `stringr::str_pad()`. 
    a. Should we amend the names before plotting? 
    b. Or should be ammend the names in the data we share?
    
*   Item 4 is addressed via `get_subtitle()`, which users can change as they please. It looks like this:

```
get_subtitle <- function(
  line1 = "Measuring: ____________________ Measurement date: ____________________",
  line2 = "Recording: ____________________",
  line3 = "Checking: _____________________ Checked date: ________________________") {

  paste0(
    "\n",
    paste0(line1, "\n"),
    "\n",
    paste0(line2, "\n"),
    "\n",
    line3
  )
}
```

> Mauro, letâ€™s print a few quadrats of different densities and finalize on Monday. {using tree tag size 3}

--Stuart

```{r}
# Filter quadrates with low, midd and high density (two of each)
increasing_tag_n <- tag_n[order(tag_n)]
density_low <- head(increasing_tag_n, 2)
middle <- round(length(increasing_tag_n) / 2)
density_middle <- increasing_tag_n[middle:(middle + 1)]
density_high <- tail(increasing_tag_n, 2)
density_diverse_n <- c(density_low, density_middle, density_high)
name_of_density_diverse <- names(density_diverse_n)
density_diverse <- sin_q20[name_of_density_diverse]
```

```{r}
pdf(onefile = TRUE, paper = "a4", width = 11, height = 11)
lapply_plot_repel(density_diverse, site = this_site)
dev.off()
```

